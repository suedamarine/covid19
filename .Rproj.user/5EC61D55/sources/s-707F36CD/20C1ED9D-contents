library(tidyverse)


# data from https://github.com/CSSEGISandData/COVID-19
# cases up to 22nd January - 24st march 2020

Date <- c("1/22/20","1/23/20","1/24/20","1/25/20","1/26/20","1/27/20","1/28/20","1/29/20","1/30/20","1/31/20","2/1/20","2/2/20","2/3/20","2/4/20","2/5/20","2/6/20","2/7/20","2/8/20","2/9/20","2/10/20","2/11/20","2/12/20","2/13/20","2/14/20","2/15/20","2/16/20","2/17/20","2/18/20","2/19/20","2/20/20","2/21/20","2/22/20","2/23/20","2/24/20","2/25/20","2/26/20","2/27/20","2/28/20","2/29/20","3/1/20","3/2/20","3/3/20","3/4/20","3/5/20","3/6/20","3/7/20","3/8/20","3/9/20","3/10/20","3/11/20","3/12/20","3/13/20","3/14/20","3/15/20","3/16/20","3/17/20","3/18/20","3/19/20","3/20/20","3/21/20", "3/22/20", "3/23/20", "3/24/20", "3/25/20", "3/26/20", "3/27/20")
Date <- as.Date(Date, format = "%m/%d/%Y")

# Cases data

Italy <- c(0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,20,62,155,229,322,453,655,888,1128,1694,2036,2502,3089,3858,4636,5883,7375,9172,10149,12462,12462,17660,21157,24747,27980,31506,35713,41035,47021,53578,59138,63927,69176,74386,80589,86498)
Spain <- c(0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,6,13,15,32,45,84,120,165,222,259,400,500,673,1073,1695,2277,2277,5232,6391,7798,9942,11748,13910,17963,20410,25374,28768,35136,39885,49515,57786,65719)
S_Korea <- c(1,1,2,2,3,4,4,4,4,11,12,15,15,16,19,23,24,24,25,27,28,28,28,28,28,29,30,31,31,104,204,433,602,833,977,1261,1766,2337,3150,3736,4335,5186,5621,6088,6593,7041,7314,7478,7513,7755,7869,7979,8086,8162,8236,8320,8413,8565,8652,8799,8961,8961,9037,9137,9241,9332)
Hebei_C <- c(1,1,2,8,13,18,33,48,65,82,96,104,113,126,135,157,172,195,206,218,239,251,265,283,291,300,301,306,306,307,308,309,311,311,311,312,317,318,318,318,318,318,318,318,318,318,318,318,318,318,318,318,318,318,318,318,318,318,318,318)
UK <- c(0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,3,3,3,8,8,9,9,9,9,9,9,9,9,9,9,9,9,13,13,13,15,20,23,36,40,51,85,115,163,206,273,321,382,456,456,798,1140,1140,1543,1950,2626,2689,3983,5018,5683,6650,8077,9529,11658,14543)
Hubei <- c(444,444,549,761,1058,1423,3554,3554,4903,5806,7153,11177,13522,16678,19665,22112,24953,27100,29631,31728,33366,33366,48206,54406,56249,58182,59989,61682,62031,62442,62662,64084,64084,64287,64786,65187,65596,65914,66337,66907,67103,67217,67332,67466,67592,67666,67707,67743,67760,67773,67781,67786,67790,67794,67798,67799,67800,67800,67800,67800,67800,67800,67801,67801,67801,67801)
Germany <- c(0,0,0,0,0,1,4,4,4,5,8,10,12,12,12,12,13,13,14,14,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,27,46,48,79,130,159,196,262,482,670,799,1040,1176,1457,1908,2078,3675,4585,5795,7272,9257,12327,15320,19848,22213,24873,29056,32986,37323,43938,50871)
France <- c(0,0,2,3,3,3,4,5,5,5,6,6,6,6,6,6,6,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,14,18,38,57,100,130,191,204,285,377,653,949,1126,1209,1784,2281,2281,3661,4469,4499,6633,7652,9043,10871,12612,14282,16018,19856,22304,25233,29155,32964)

# create data.frame

coviddf <- data.frame(Date, Italy, Spain, S_Korea, Hubei, UK, Germany, France)

# tidy cases

covid_cases_tidy <- coviddf %>% gather(country, cases, 'Italy':'France')

# Mortality data

Italy_m<- c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,7,10,12,17,21,29,34,52,79,107,148,197,233,366,463,631,827,827,1266,1441,1809,2158,2503,2978,3405,4032,4825,5476,6077,6820,7503,8215,9134)
Spain_m <- c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,5,10,17,28,35,54,55,133,195,289,342,533,623,830,1043,1375,1772,2311,2808,3647,4365,5138)
S_Korea_m <- c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,6,8,10,12,13,13,16,17,28,28,35,35,42,44,50,53,54,60,66,66,72,75,75,81,84,91,94,102,111,111,120,126,131,139)
UK_m <- c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,3,4,6,8,8,8,21,21,55,55,71,137,177,233,281,335,422,465,578,759)
Hubei_m <- c(17,17,24,40,52,76,125,125,162,204,249,350,414,479,549,618,699,780,871,974,1068,1068,1310,1457,1596,1696,1789,1921,2029,2144,2144,2346,2346,2495,2563,2615,2641,2682,2727,2761,2803,2835,2871,2902,2931,2959,2986,3008,3024,3046,3056,3062,3075,3085,3099,3111,3122,3130,3133,3139,3153,3153,3160,3163,3169,3174)
Germany_m <- c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,3,7,9,11,17,24,28,44,67,84,94,123,157,206,267,342)
France_m <- c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,4,4,6,9,11,19,19,33,48,48,79,91,91,148,148,148,243,450,562,674,860,1100,1331,1696,1995)

# create df

mort_df <- data.frame(Date, Italy_m, Spain_m, S_Korea_m, UK_m, Hubei_m, Germany_m, France_m)

# tidy mort data

mort_tidy <- mort_df %>% gather(country, morts, 'Italy_m':'France_m')

len <- length(Date)

# calculate rate of change of cases
Italy_r <- (Italy[2:len]-Italy[1:len-1])/Italy[1:len-1]
Spain_r <- (Spain[2:len]-Spain[1:len-1])/Spain[1:len-1]
S_Korea_r <- (S_Korea[2:len]-S_Korea[1:len-1])/S_Korea[1:len-1]
Hubei_r <- (Hubei[2:len]-Hubei[1:len-1])/Hubei[1:len-1]
UK_r <- (UK[2:len]-UK[1:len-1])/UK[1:len-1]
Germany_r <- c(Germany[2:len]-Germany[1:len-1])/Germany[1:len-1]
France_r <- (France[2:len]-France[1:len-1])/France[1:len-1]
Date_r <- Date[2:len-1]

# calculate rate of change of morts
Italy_mr <- (Italy_m[2:len]-Italy_m[1:len-1])/Italy_m[1:len-1]
Spain_mr <- (Spain_m[2:len]-Spain_m[1:len-1])/Spain_m[1:len-1]
S_Korea_mr <- (S_Korea_m[2:len]-S_Korea_m[1:len-1])/S_Korea_m[1:len-1]
Hubei_mr <- (Hubei_m[2:len]-Hubei_m[1:len-1])/Hubei_m[1:len-1]
UK_mr <- (UK_m[2:len]-UK_m[1:len-1])/UK_m[1:len-1]
Germany_mr <- c(Germany_m[2:len]-Germany_m[1:len-1])/Germany_m[1:len-1]
France_mr <- (France_m[2:len]-France_m[1:len-1])/France_m[1:len-1]
Date_r <- Date[2:len-1]

# create data frame for mort rate

mort_rate_df <- data.frame(Date_r, Italy_mr, Spain_mr, S_Korea_mr, Hubei_mr, UK_mr, Germany_mr, France_mr)


# create new data frame for rate data

rate_df <- data.frame(Date_r, Italy_r, Spain_r, S_Korea_r, Hubei_r, UK_r)

# gather rate data 

rate_df <- rate_df %>%
  gather(country, rate_change, 'Italy_r':'UK_r')

# plot some data

rate_df %>% ggplot(aes(Date_r, rate_change, color = country)) + geom_point() + geom_smooth() + ylim(0,0.4)


# filter for spain or italy                                                                                                                                      
rate_df %>% filter(country %in% c("Italy_r", "Spain_r")) %>% ggplot(aes(Date_r, rate_change, color = country)) + geom_point()  + stat_smooth() + ylim(0,0.6)

# plot number of cases
coviddf %>% gather(country, cases, 'Italy':'France') %>% ggplot(aes(Date, cases, color = country)) + geom_point() + scale_y_continuous(trans = "log10") +stat_smooth()

# plot number of morts
mort_df %>% gather(country, morts, 'Italy_m':'France_m') %>% ggplot(aes(Date, morts, color = country)) + geom_point() + scale_y_continuous(trans = "log10") + stat_smooth()

# plot mort rate

mort_rate_df %>% gather(country, mort_rate, 'Italy_mr':'France_mr') %>% ggplot(aes(Date_r, mort_rate, color = country)) + geom_point() + stat_smooth() +ylim(0, 1.0)




